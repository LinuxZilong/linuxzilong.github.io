Vagrant.configure("2") do |config|
    servers = [
      {name: "server1", ip: "192.168.33.10:private_network,10.0.0.10:public_network"},
      {name: "server2", os: "ubuntu/lunar64:v20230301.0.0", ip: "192.168.33.11", cpu: "2", mem: "2048"},
    ]
    
    default_cpu = "1"
    default_mem = "1024"
    default_network_mode = "private_network"
    default_os = "ubuntu/trusty64"

    # default_os = "ubuntu/jammy64:v20230314.0.0"
    
    servers.each do |server|
      config.vm.define server[:name] do |node|
        # if server[:os]
        #   os_name, os_version = server[:os].split(':')
        #   puts "操作系统名称：#{os_name}"
        #   puts "操作系统版本：#{os_version}"
        # else
        #   os_name, os_version = default_os.split(':')
        #   puts "未指定操作系统,使用默认操作系统名称：#{os_name}"
        #   puts "未指定操作系统,使用默认操作系统版本：#{os_version}"          
        # end


        # if defined?(name)
        #   puts "变量 name 已定义"
        # else
        #   puts "变量 name 未定义"
        # end

        # node1.vm.box = "centos/7"
        # node1.vm.box_version = "1809.01"
        config.ssh.password = "vagrant"

        os_name = server[:os]&.split(":")&.[](0) || default_os&.split(":")&.[](0)
        puts "os_name #{os_name}"
        os_version = server[:os]&.split(":")&.[](1) || default_os&.split(":")&.[](1)
        puts "os_version #{os_version}"
        node.vm.box = os_name
        node.vm.hostname = os_version

        # 可以使用 Ruby 的 String#split 方法来切割字符串，并取出第一个元素，示例如下：
        # node.vm.box = server[:os].split(":").first || default_os
        # 这将会把 server[:os] 字符串以冒号为分隔符切割成数组，然后取出第一个元素 "ubuntu/focal64" 作为 node.vm.box 的值。如果 server[:os] 为 nil 或者没有冒号，那么 default_os 将会被赋值给 node.vm.box。
        # 然后使用数组下标 [1] 来取得第二个元素


        node.vm.network default_network_mode
    
        if server.key?(:ip)
          server[:ip].split(",").each do |ip_with_network|
            ip, network_mode = ip_with_network.split(':')
            ip.strip!
            network_mode = network_mode&.to_sym || :private_network
            node.vm.network network_mode, ip: ip
          end
        end
    
        node.vm.provider :virtualbox do |vb|
          vb.memory = server[:mem] || default_mem
          vb.cpus = server[:cpu] || default_cpu
        end
       end
    end
end





# Vagrant.configure("2") do |config|
#   servers = [
#     {name: "server1", ip: "192.168.33.10:private_network,10.0.0.10:public_network"},
#     {name: "server2", os: "ubuntu/focal64:v20230214.0.0", ip: "192.168.33.11"},
#     {name: "server3", ip: "192.168.33.12", cpu: "2", mem: "2048"}
#   ]

#   default_cpu = "1"
#   default_mem = "1024"
#   default_network_mode = "private_network"
#   default_os = "ubuntu/bionic64:123"

#   servers.each do |server|
#     config.vm.define server[:name] do |node|
#       node.vm.box = (server[:os]&.split(":")&.[](0) || default_os)&.split(":")&.[](0)

#       node.vm.hostname = server[:name]

#       node.vm.network server[:ip].split(",").map { |ip| ip.split(":") }.map { |ip, mode| mode ? "#{mode},#{ip}" : "#{default_network_mode},#{ip}" }

#       node.vm.provider :virtualbox do |vb|
#         vb.customize ["modifyvm", :id, "--cpus", server[:cpu] || default_cpu]
#         vb.customize ["modifyvm", :id, "--memory", server[:mem] || default_mem]
#       end
#     end
#   end
# end
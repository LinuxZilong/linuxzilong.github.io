
## NET 打洞

https://zhuanlan.zhihu.com/p/108635427

https://mthli.xyz/p2p-hole-punching/

https://cguling.github.io/2020/07/04/P2P_1.html

https://zhuanlan.zhihu.com/p/86759357

NAT打洞是一种技术，用于在两个私有网络之间建立直接的点对点连接，即使它们都位于防火墙后面或使用了网络地址转换（NAT）。其基本原理是通过向NAT设备发送一些特定的数据包，从而建立直接的连接。


客户端A和客户端B都位于NAT网络中，无法直接建立连接。  
客户端A和客户端B分别向中继服务器发送一条UDP消息，这样NAT设备就会将客户端的公网IP地址和端口号映射到NAT设备上的一个端口上。  
客户端A向客户端B发送一条UDP消息，并将其中的IP地址和端口号设置为中继服务器返回的公网IP地址和端口号。  
由于客户端A和客户端B都向NAT设备发送了UDP消息，因此NAT设备会将客户端A和客户端B的公网IP地址和端口号映射到不同的端口上。  
客户端B向客户端A发送一条UDP消息，并将其中的IP地址和端口号设置为客户端A的公网IP地址和端口号。  
由于客户端B和客户端A都向NAT设备发送了UDP消息，因此NAT设备会将客户端B和客户端A的公网IP地址和端口号映射到不同的端口上。  
如果客户端A和客户端B的公网IP地址和端口号映射到的端口号相同，那么客户端A和客户端B就可以直接建立连接了。  
如果客户端A和客户端B的公网IP地址和端口号映射到的端口号不同，那么它们可以通过中继服务器进行通信，从而建立间接的连接。 


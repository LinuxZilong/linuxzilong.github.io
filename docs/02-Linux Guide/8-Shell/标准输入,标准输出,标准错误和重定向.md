学完本节后，您应能够通过 shll 重定向将输出或错误保存到文件中，并利用管道通过多个程序处理命令输出。

## 标准输入、标准输出和标准错误

进程使用称为"文件描述符"的编号通道来获取输入并发送输出。所有进程在开始时至少要有三个文件描述符:

![1685531085453](image/标准输入,标准输出,标准错误/1685531085453.svg)

通道（文件描述符）

| 编号 | 通道名称 | 描述     | 默认连接 | 用法          |
| ---- | -------- | -------- | -------- | ------------- |
| 0    | stdin    | 标准输入 | 键盘     | 仅读取        |
| 1    | stdout   | 标准输出 | 终端     | 仅写入        |
| 2    | stderr   | 标准错误 | 终端     | 仅写入        |
| 3+   | filename | 其他文件 | 无       | 读取和/或写入 |

## 将输出重定向到文件
/O重定向可更改进程获取其输入或输出的方式。该进程并不是从键盘获取输入，也不是将输出和
错误发送到终端，而是执行文件读取或写入。重定向允许您将消息保存到通常发送给终端窗口的文
件中。或者，您也可以使用重定向来丢弃输出或错误，这样它们就不会显示在终端上或保存下来。
重定向stdout可以阻止进程输出显示在终端上。如下表所示，仅重定向stdout不会阻止
stderr错误消息显示在终端上。如果文件不存在，则会创建文件。如果文件确实存在，但是所需
的重定向没有附加到文件，则该文件的内容将被覆盖。



如果想丢弃消息，特殊文件/dev/nu11以静默方式丢弃重定向到其自身的通道输出，并且始终是
空文件。


**输出重定向操作符**

![1685531525180](image/标准输入,标准输出,标准错误/1685531525180.svg)

:::caution
https://www.cnblogs.com/520playboy/p/6275022.html

重要
重定向操作的顺序非常重要。以下序列将标准输出重定向到f11e,然后将标准错误
作为标准输出重定向到相同位置（仟i1e)。
>fi1e2>&1
但是，下一个序列以相反的顺序执行重定向。这会将标准错误重定向到标准输出的默
认位置（终端窗口，因此没有任何更改），然后仅将标准输出重定向到f11e。
2>&1>fi1e
因此，有些人更倾向于使用合并重定向运算符：
&>file
而不是
>fi1e2>&1
&>>f11e
而不是
>>f11e2>&1
(在Bash4/RHEL6和更高版本中)
但是，某些系统管理员和程序员也会使用与bash相关的其他shel(称为“兼容
Bourne的shell'”)对命令进行脚本编制，这些人认为应避免使用较新的合并重定向
运算符，因为这些运算符并没有标准化，也没有在所有这些shl中实施，而且还存
在其他限制因素。
本课程的作者对该主题采取中立立场，因此您可能会在课程中遇到这两种语法。
:::


## 构建管道
管道是一个或多个命令的序列，用竖线字符()分隔。管道将第一个命令的标准输出连接到下一个命
令的标准输入。

![1685531733810](image/标准输入,标准输出,标准错误/1685531733810.svg)

在某个进程输出到终端之前，管道允许另一个进程操作和格式化该进程的输出。为便于理解，可以
这样想象一下：数据正在通过管道从一个进程“流”向另一个进程，并且在其流过的管道中每个命
令都会略微对其做些改动。
:::caution 注意
管道和/O重定向都可以操作标准输出和标准输入。重定向会向文件发送标准输出或
从文件获取标准输入。管道会将一个进程的标准输出发送到另一个进程的标准输入。
:::
## 管道示例
本示例取1s命令的输出并使用1ess在终端上以一次一屏的方式显示输出。
[user@host ~]1s -1 /usr/bin less
1s命令的输出传送到wc-1,用于统计从1s收到的行数并将该行数显示在终端。
RH124-L8.0-zhcn-1-20190531
123
章5|创建、查看和编辑文本文件
[user@host -]1s I wc -1
在此管道中，head将输出1s-t输出内容的前10行，并且最终结果会重定向到一个文件。
[user@host ~]1s -t head -n 10 >/tmp/ten-last-changed-files
## 输出重定向示例
通过重定向，可以简化许多日常管理任务。在思考下列示例时，请参考前面的表格：
·保存时间戳以供日后参考。
[user@host -]date /tmp/saved-timestamp
·将一个日志文件的最后100行复制到另一文件。
[user@host -]tail -n 100 /var/log/dmesg >/tmp/last-100-boot-messages
·将四个文件连接为一个。
[user@host ~]cat file1 file2 file3 file4 /tmp/all-four-in-one
·将主目录的隐藏文件名和常规文件名列出到文件中。
[user@host -]ls -a /tmp/my-file-names
·将输出附加到现有文件。
[user@host ~]echo "new line of information">>/tmp/many-lines-of-information
[user@host -]diff previous-file current-file >>/tmp/tracking-changes-made

·接下来的几个命令会生成错误消息，因为普通用户无法访问某些系统目录。观察错误消息如何被
重定向。在终端上查看普通命令输出时，将错误重定向到文件。
[user@host ~]find /etc -name passwd 2>/tmp/errors
·将进程输出和错误消息保存到单独的文件中。
[user@host -]find /etc -name passwd /tmp/output 2>/tmp/errors
·忽略并丢弃错误消息。
[user@host -]find /etc -name passwd /tmp/output 2>/dev/null
·将输出和生成的错误消息存储在一起。
[user@host -]find /etc -name passwd &>/tmp/save-both
·将输出和生成的错误附加到现有文件。
[user@host -]find /etc -name passwd >>/tmp/save-both 2>&1
## 管道、重定向和tee命令
当重定向与管道组合时，shll会首先设置整个管道，然后重定向输入/输出。如果在管道的中间使
用了输出重定向，则输出将转至文件，而不是前往管道中的下一个命令。
在本示例中，1s命令的输出将转至文件，并且1ess不会在终端上显示任何内容。
[user@host -]1s /tmp/saved-output less
tee命令克服了这个限制。在管道中，tee将其标准输入复制到其标准输出中，并且还将标准输出
重定向到指定为命令参数的文件。如果您将数据想象成流经管道的水，那么可将tee视觉化为管道
中的T形接头，它负责输出在两个方向上的流向。

![1685531896381](image/标准输入,标准输出,标准错误/1685531896381.svg)


## 使用tee命令的管道示例
本示例将1s命令的输出重定向到文件，并且将输出传递到1ess以便在终端上以一次一屏的方式显
示。
[user@host ~]1s -1 tee /tmp/saved-output less
如果在管道末尾使用了tee,则可以保存命令的最终输出并且同时输出到终端。
[user@host -]1s -t head -n 10 tee /tmp/ten-last-changed-files
重要
可通过管道来重定向标准错误，但是不能使用合并重定向运算符(&>和&>>)执行
此操作。
以下是通过管道重定向标准输出和标准错误的正确方法：
[user@host -]find -name passwd 2>&1 less

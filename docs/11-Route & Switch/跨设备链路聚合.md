---
categories:
  - blog
  - posts
  - RS路由交换
  - 未发布
toc: true
title: 链路聚合
---

<!--more-->

# 跨设备链路聚合

## DRNI对比IRF优势

普通IRF聚合的链路只能够在一台设备上，只能提供链路级的保护，当设备故障以后，普通聚合将无法工作，所以需要设备级保护的技术。

DRNI（Distributed Resilient Network Interconnect，分布式弹性网络互连）作为一种跨设备链路聚合的技术，除了具备增加带宽、提高链路可靠性、负载分担的优势外，还具备以下优势：
· 更高的可靠性
把链路可靠性从单板级提高到了设备级。
· 简化组网及配置
提供了一个没有环路的二层拓扑，同时实现冗余备份，不再需要繁琐的生成树协议配置，极大地简化了组网及配置。
· 独立升级
两台设备可以分别进行升级，保证有一台设备正常工作即可，对正在运行的业务几乎没有影响。

DRNI是一种跨设备链路聚合技术，将两台物理设备在聚合层面虚拟成一台设备来实现跨设备链路聚合，从而提供设备级冗余保护和流量负载分担。

## 问题：DRNI与VRRP结合应用场景，DRNI VRRP如何实现的南向北流量负载

#### 解决方法

1）VRRP和DRNI组合应用的组网环境中，建议使用VRRP标准协议模式。升级时建议配置为非抢占模式。 

2）DRNI里VRRP不是主备，是双转。在DRNIi组网中，VRRP做了特殊处理，不完全参考协议标准，VRRP的备设备也可以转发流量，从而实现了负载分担， 在该典型组网中，VRRP仍使用标准模式。 

3）实现原理： 在协议标准中，VRRP只有master转发流量，backup不转发流量， 原因是， 两个VRRP网关设备，拥有相同网关IP， 但是只有master设备会下发虚MAC地址，流量向网关发送ARP请求MAC时，设备应答该虚MAC， 随后流量以该虚MAC作为目的MAC发送流量，流量到了master设备，命中了MAC表项可转发，如果到了backup设备，由于backup未下发MAC所以无法命中MAC，不会转发，转由master转发。

 在DRNI组网中，VRRP特殊处理，VRRP使用在master端正常下发了VRRP的虚MAC，同时在backup端下发了一个DRNI类型的虚MAC，但是MAC地址是相同的，流量向网关发送ARP请求MAC时，仍能得到该虚MAC应答，流量不论到了backup还是master，均能命中MAC表项，可直接转发，无需走IPL链路， 在DRNI组网下，流量通过hash，发到了两个VRRP网关上，且两个VRRP网关均有转发能力，因此实现了负载分担，与VRRPE（vrrp负载分担）有区别。

 VRRPE（vrrp负载分担），两台VRRP网关拥有相同的网关IP，但是拥有不同的虚MAC，流量向网关发送ARP请求MAC时， VRRP根据ARP请求的源MAC，通过一定算法，应答不同的虚MAC，各个流量根据自己学到的虚MAC，填为目的MAC，发送流量，由于这些流量具有不同的目的MAC，因此会走到不同的VRRP设备上，实现负载分担。 

下行设备区PING 网关的话主处理，转发流量可以双转。